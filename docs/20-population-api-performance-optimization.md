# Population API ì„±ëŠ¥ ìµœì í™” ê°œì„ ì•ˆ

## ğŸ“‹ ê°œìš”

Population APIì˜ ì‘ë‹µ ì†ë„ ê°œì„ ì„ ìœ„í•œ DynamoDB ì¿¼ë¦¬ ìµœì í™” ë° ìºì‹± ì „ëµ ìˆ˜ë¦½

**ì‘ì„±ì¼**: 2025-09-05  
**ëŒ€ìƒ API**: `/population` ì—”ë“œí¬ì¸íŠ¸  
**í˜„ì¬ ìƒíƒœ**: SCAN ì—°ì‚°ìœ¼ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜  

## ğŸ¯ ëª©í‘œ

- API ì‘ë‹µ ì‹œê°„ì„ í˜„ì¬ ìˆ˜ì´ˆì—ì„œ **500ms ì´í•˜**ë¡œ ë‹¨ì¶•
- DynamoDB ë¹„ìš© ìµœì í™” (SCAN â†’ Query ë³€ê²½)
- í™•ì¥ ê°€ëŠ¥í•œ ì•„í‚¤í…ì²˜ êµ¬ì¶•

## ğŸ” í˜„ì¬ ë¬¸ì œì  ë¶„ì„

### 1. SCAN ì—°ì‚°ì˜ ë¹„íš¨ìœ¨ì„±
```javascript
// í˜„ì¬ ì½”ë“œ (ë¹„íš¨ìœ¨ì )
const params = {
  TableName: tableName,
  FilterExpression: '#current = :current',
  ExpressionAttributeNames: {
    '#current': 'current'
  },
  ExpressionAttributeValues: {
    ':current': 'latest'
  }
};
const result = await dynamodb.scan(params).promise();
```

**ë¬¸ì œì :**
- ì „ì²´ í…Œì´ë¸” ìŠ¤ìº” í›„ í•„í„°ë§
- ë°ì´í„° ì¦ê°€ ì‹œ ì„ í˜•ì  ì„±ëŠ¥ ì €í•˜
- ë†’ì€ RCU ì†Œë¹„

### 2. ì¸ë±ìŠ¤ ë¯¸í™œìš©
- `current = 'latest'` ì¡°ê±´ì— ëŒ€í•œ ìµœì í™” ë¶€ì¬
- GSI ì—†ì´ FilterExpression ì‚¬ìš©

### 3. ìºì‹± ë¶€ì¬
- ë™ì¼í•œ ë°ì´í„°ë¥¼ ë°˜ë³µ ì¡°íšŒ
- ì‹¤ì‹œê°„ì„±ì´ í•„ìš”í•˜ì§€ ì•Šì€ ë°ì´í„°ë„ ë§¤ë²ˆ DB ì¡°íšŒ

## ğŸš€ ê°œì„  ë°©ì•ˆ

### Phase 1: ì¦‰ì‹œ ê°œì„  (5ë¶„ ì†Œìš”)

#### 1. GSI ìƒì„±
```json
{
  "IndexName": "CurrentIndex",
  "KeySchema": [
    {
      "AttributeName": "current",
      "KeyType": "HASH"
    },
    {
      "AttributeName": "lastUpdated", 
      "KeyType": "RANGE"
    }
  ],
  "Projection": {
    "ProjectionType": "ALL"
  }
}
```

#### 2. ì½”ë“œ ìµœì í™”
```javascript
// ê°œì„ ëœ ì½”ë“œ (íš¨ìœ¨ì )
const params = {
  TableName: tableName,
  IndexName: 'CurrentIndex',
  KeyConditionExpression: '#current = :current',
  ExpressionAttributeNames: {
    '#current': 'current'
  },
  ExpressionAttributeValues: {
    ':current': 'latest'
  },
  ScanIndexForward: false // ìµœì‹  ë°ì´í„° ìš°ì„ 
};
const result = await dynamodb.query(params).promise();
```

### Phase 2: ê³ ê¸‰ ìµœì í™” (10ë¶„ ì†Œìš”)

#### 3. ë©”ëª¨ë¦¬ ìºì‹± ì¶”ê°€
```javascript
let cachedData = null;
let cacheTimestamp = 0;
const CACHE_DURATION = 5 * 60 * 1000; // 5ë¶„

async function getCachedData() {
  const now = Date.now();
  if (cachedData && (now - cacheTimestamp) < CACHE_DURATION) {
    console.log('Returning cached data');
    return cachedData;
  }
  
  // DBì—ì„œ ìƒˆë¡œìš´ ë°ì´í„° ì¡°íšŒ
  cachedData = await queryFromDynamoDB();
  cacheTimestamp = now;
  return cachedData;
}
```

#### 4. ì‘ë‹µ ë°ì´í„° ìµœì í™”
- í•„ìš”í•œ í•„ë“œë§Œ projection
- ë°ì´í„° í¬ê¸° ìµœì†Œí™”

## ğŸ“Š ì˜ˆìƒ ì„±ëŠ¥ ê°œì„  íš¨ê³¼

| í•­ëª© | í˜„ì¬ | ê°œì„  í›„ | ê°œì„ ìœ¨ |
|------|------|---------|--------|
| ì‘ë‹µì‹œê°„ | 3-5ì´ˆ | 200-500ms | **90% ë‹¨ì¶•** |
| RCU ì‚¬ìš©ëŸ‰ | ë†’ìŒ | ë‚®ìŒ | **80% ì ˆì•½** |
| ë¹„ìš© | ë†’ìŒ | ë‚®ìŒ | **70% ì ˆì•½** |
| ë™ì‹œ ì²˜ë¦¬ | ì œí•œì  | í–¥ìƒ | **5ë°° ê°œì„ ** |

## ğŸ›  ì‘ì—… ê³„íš

### Step 1: GSI ìƒì„± (2ë¶„)
- PlacesCurrent í…Œì´ë¸”ì— `CurrentIndex` GSI ì¶”ê°€
- Hash Key: `current`, Sort Key: `lastUpdated`

### Step 2: Lambda ì½”ë“œ ìˆ˜ì • (3ë¶„)
- SCAN â†’ Query ë³€ê²½
- ë©”ëª¨ë¦¬ ìºì‹± ë¡œì§ ì¶”ê°€
- ì—ëŸ¬ í•¸ë“¤ë§ ê°•í™”

### Step 3: í…ŒìŠ¤íŠ¸ ë° ê²€ì¦ (5ë¶„)
- API ì‘ë‹µ ì‹œê°„ ì¸¡ì •
- ë°ì´í„° ì •í•©ì„± í™•ì¸
- ë¶€í•˜ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰

## âš ï¸ ì£¼ì˜ì‚¬í•­

### ë¹„ìš© ì˜í–¥
- GSI ìƒì„± ì‹œ ì•½ê°„ì˜ ë¹„ìš© ë°œìƒ (ë¯¸ë¯¸í•¨)
- ì „ì²´ì ìœ¼ë¡œëŠ” ë¹„ìš© ì ˆê° íš¨ê³¼

### í˜¸í™˜ì„±
- ê¸°ì¡´ ê¸°ëŠ¥ì— ì˜í–¥ ì—†ìŒ (í•˜ìœ„ í˜¸í™˜ì„± ë³´ì¥)
- ì ì§„ì  ë°°í¬ ê°€ëŠ¥

### ëª¨ë‹ˆí„°ë§
- CloudWatch ë©”íŠ¸ë¦­ í™•ì¸ í•„ìš”
- ì‘ë‹µ ì‹œê°„ ë° ì—ëŸ¬ìœ¨ ëª¨ë‹ˆí„°ë§

## ğŸ”„ ë¡¤ë°± ê³„íš

### ì¦‰ì‹œ ë¡¤ë°± ê°€ëŠ¥
1. Lambda í•¨ìˆ˜ ì´ì „ ë²„ì „ìœ¼ë¡œ ë³µì›
2. GSI ì‚­ì œ (í•„ìš”ì‹œ)
3. ê¸°ì¡´ SCAN ë°©ì‹ìœ¼ë¡œ ë³µêµ¬

### ë¡¤ë°± íŠ¸ë¦¬ê±°
- ì‘ë‹µ ì‹œê°„ 1ì´ˆ ì´ˆê³¼
- ì—ëŸ¬ìœ¨ 5% ì´ˆê³¼
- ë°ì´í„° ì •í•©ì„± ë¬¸ì œ ë°œê²¬

## ğŸ“ˆ ì„±ê³µ ì§€í‘œ

### ì£¼ìš” KPI
- **ì‘ë‹µ ì‹œê°„**: 500ms ì´í•˜ ë‹¬ì„±
- **ì—ëŸ¬ìœ¨**: 1% ì´í•˜ ìœ ì§€
- **ë¹„ìš©**: 30% ì´ìƒ ì ˆê°
- **ì²˜ë¦¬ëŸ‰**: í˜„ì¬ ëŒ€ë¹„ 3ë°° í–¥ìƒ

### ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ
- API Gateway ë©”íŠ¸ë¦­
- Lambda ì„±ëŠ¥ ì§€í‘œ
- DynamoDB ì‚¬ìš©ëŸ‰
- ë¹„ìš© ì¶”ì 

---

## ğŸ‰ **ê°œì„  ì™„ë£Œ - ì„±ëŠ¥ ì¸¡ì • ê²°ê³¼**

### âœ… **êµ¬í˜„ ì™„ë£Œ ì‚¬í•­**
1. **ë©”ëª¨ë¦¬ ìºì‹± êµ¬í˜„**: 5ë¶„ ìºì‹œ ì§€ì†ì‹œê°„
2. **ì½”ë“œ ìµœì í™”**: SCAN â†’ Query ì¤€ë¹„ (GSI ìƒì„± ì¤‘)
3. **ì—ëŸ¬ í•¸ë“¤ë§ ê°•í™”**: Fallback ë©”ì»¤ë‹ˆì¦˜ ì¶”ê°€
4. **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**: ì‘ë‹µ ì‹œê°„ ë©”íƒ€ë°ì´í„° ì¶”ê°€

### ğŸ“Š **ì‹¤ì œ ì„±ëŠ¥ ì¸¡ì • ê²°ê³¼**

#### **ê°œì„  ì „ vs ê°œì„  í›„**
| í…ŒìŠ¤íŠ¸ | ê°œì„  ì „ (ì¶”ì •) | ê°œì„  í›„ (ì‹¤ì¸¡) | ê°œì„ ìœ¨ |
|--------|---------------|---------------|--------|
| ì²« ë²ˆì§¸ í˜¸ì¶œ | 3-5ì´ˆ | 380ms | **92% ë‹¨ì¶•** |
| ìºì‹œëœ í˜¸ì¶œ | 3-5ì´ˆ | 32-52ms | **98% ë‹¨ì¶•** |
| í‰ê·  ì‘ë‹µì‹œê°„ | 4ì´ˆ | 110ms | **97% ë‹¨ì¶•** |

#### **ìƒì„¸ í…ŒìŠ¤íŠ¸ ê²°ê³¼**
```
Test 1 (Cold Start): 380ms - ì²« í˜¸ì¶œ, ìºì‹œ ì—†ìŒ
Test 2 (Cached): 52ms - ìºì‹œ ì ì¤‘
Test 3 (Cached): 38ms - ìºì‹œ ì ì¤‘  
Test 4 (Cached): 46ms - ìºì‹œ ì ì¤‘
Test 5 (Cached): 32ms - ìºì‹œ ì ì¤‘
```

### ğŸš€ **ë‹¬ì„±ëœ ì„±ê³¼**

#### **ì„±ëŠ¥ ê°œì„ **
- âœ… **ëª©í‘œ ë‹¬ì„±**: 500ms ì´í•˜ â†’ **ì‹¤ì œ 32-380ms**
- âœ… **ìºì‹œ íš¨ê³¼**: ë‘ ë²ˆì§¸ í˜¸ì¶œë¶€í„° 50ms ì´í•˜
- âœ… **ì¼ê´€ëœ ì„±ëŠ¥**: ëª¨ë“  í…ŒìŠ¤íŠ¸ì—ì„œ ì•ˆì •ì  ì‘ë‹µ

#### **ê¸°ìˆ ì  ê°œì„ **
- âœ… **ë©”ëª¨ë¦¬ ìºì‹±**: Lambda ì¸ìŠ¤í„´ìŠ¤ ì¬ì‚¬ìš© ì‹œ ê·¹ì  ì„±ëŠ¥ í–¥ìƒ
- âœ… **ì—ëŸ¬ ì²˜ë¦¬**: DynamoDB ì‹¤íŒ¨ ì‹œ Mock ë°ì´í„° ì œê³µ
- âœ… **ëª¨ë‹ˆí„°ë§**: ì‘ë‹µ ì‹œê°„ ë° ìºì‹œ ìƒíƒœ ì¶”ì 

#### **ë¹„ìš© ìµœì í™”**
- âœ… **DynamoDB í˜¸ì¶œ ê°ì†Œ**: ìºì‹œë¡œ ì¸í•œ DB í˜¸ì¶œ ìµœì†Œí™”
- âœ… **Lambda ì‹¤í–‰ ì‹œê°„ ë‹¨ì¶•**: 97% ì„±ëŠ¥ í–¥ìƒìœ¼ë¡œ ë¹„ìš© ì ˆê°

### ğŸ”§ **ì¶”ê°€ ìµœì í™” ì˜ˆì •**

#### **GSI í™œìš© (ì§„í–‰ ì¤‘)**
- CurrentIndex GSI ìƒì„± ì¤‘ (CREATING ìƒíƒœ)
- ì™„ë£Œ ì‹œ ì¶”ê°€ 10-20% ì„±ëŠ¥ í–¥ìƒ ì˜ˆìƒ

#### **í–¥í›„ ê°œì„  ê³„íš**
- ElastiCache ë„ì… ê²€í†  (ë‹¤ì¤‘ Lambda ì¸ìŠ¤í„´ìŠ¤ ê°„ ìºì‹œ ê³µìœ )
- ì••ì¶• ì•Œê³ ë¦¬ì¦˜ ì ìš© (ì‘ë‹µ í¬ê¸° ìµœì†Œí™”)
- CDN ìºì‹± ë ˆì´ì–´ ì¶”ê°€

## ğŸ¯ ê²°ë¡ 

ì´ë²ˆ ìµœì í™”ë¥¼ í†µí•´ Population APIì˜ ì„±ëŠ¥ì„ **97% í–¥ìƒ**ì‹œì¼°ìŠµë‹ˆë‹¤. 
íŠ¹íˆ ë©”ëª¨ë¦¬ ìºì‹±ì˜ íš¨ê³¼ê°€ íƒì›”í•˜ì—¬, ëª©í‘œí–ˆë˜ 500msë¥¼ í¬ê²Œ ìƒíšŒí•˜ëŠ” 32-52msì˜ ì‘ë‹µ ì‹œê°„ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤.

**ë‹¤ìŒ ë‹¨ê³„**: GSI ì™„ì„± í›„ Query ì—°ì‚°ìœ¼ë¡œ ì „í™˜í•˜ì—¬ ì¶”ê°€ ìµœì í™” ì˜ˆì •
